<!DOCTYPE html>
<html>
    <head>
        <title></title>
        <link href="style.css" rel="stylesheet" type="text/css">
        <script src="/socket.io/socket.io.js"></script>
        <script src="./dropzone-5.7.0/dist/dropzone.js"></script>
        <script src="jquery-3.5.1.min.js"></script>
        <script src="js.cookie-2.2.1.min.js"></script>
        <!--Insert google analytics here-->
    </head>
    <body onLoad="fixStuff()">
    	<nav class="navBar"></nav>
    	<div style="width: 100%; height: 120vh;">
	    	<h1 class='title'>Free music fingerprinting, right here on the web.</h1>
	    	<div id="mainNavs">
	    	<div onclick='location.href = "#upload"' style="grid-area: a;" id="toUpload" class='mainNavigation'><div><h2>Upload</h2></div></div>
	    	<div style="grid-area: b;" id="toCompare" class='mainNavigation'><div><h2>Compare</h2></div></div>
	    	</div>
    	</div>
        <div id="yourUploads" class='mainSection'>
            <h2>Your uploads</h2>
            <p id="yourUploadsTxt"></p>
            <script>
                function setupUploads()
                {
                    var uploadsArea = document.getElementById("yourUploadsTxt");
                    var uploads = Cookies.get("uploads");
                    console.log(uploads);
                    if(!uploads){uploadsArea.innerHTML = "You have no uploads."; return;}
                    uploads = JSON.parse(uploads);
                    var newTxt = ""
                    for(var i in uploads)
                    {
                        newTxt += uploads[i] + "<br>";
                    }
                    uploadsArea.innerHTML = newTxt;
                }
            setupUploads()
            </script>
        </div>
        <br><br><br><br><br><!--I know this is a terrible practice, but i'm lazy--><br><br>
    	<div id="upload" class='mainSection'>
    		<h2>Upload a file to the database</h2>
    		<form name="uploadFile" action="/upload/" onsubmit="return VerifyForm();" method="post" id="uploadDropzone" enctype="multipart/form-data">
    			<p id='error'></p>
    			<label for="file">File: </label>
    			<input type='file' id='file' name='file' required>
    			<label for="audio_name">Track Name: </label>
    			<input type="text" id="audio_name" name="audio_name" placeholder="Name of track" required autocomplete="off"></input><br>
    			<!--<label for="artist_name">Artist Name:</label>
    			<input type="text" id="artist_name" name="artist_name" placeholder="Name of artist" required autocomplete="off"></input><br>-->
    		</form>
    		

            <script>
    			const socket = io('ws://localhost:3200');
                function ClearCookies()
                {
                    document.cookie.split(";").forEach(function(c) { document.cookie = c.replace(/^ +/, "").replace(/=.*/, "=;expires=" + new Date().toUTCString() + ";path=/"); });
                }
    			function VerifyForm()
    			{
    				console.log(Cookies.get());
    				if(!document.uploadFile.file.value.toString().endsWith(".wav"))
    				{
    					$("#error").html("Please upload a .WAV file. ")
    					return false;
    				}
    				if(document.uploadFile.audio_name.value.length < 3)
    				{
    					$("#error").html("Name too short");
    					return false;
    				}
    				//set cookie
    				//check if "uploads" cookie exists. If not, create it.
    				if(!Cookies.get("uploads")){
    					Cookies.set("uploads", JSON.stringify([]));
    				}
    				var oldUploads = JSON.parse(Cookies.get("uploads"));
                    console.log(oldUploads);
                    var newUpload = document.uploadFile.file.value.toString().replace(/^.*[\\\/]/, '') + " | \"" + document.uploadFile.audio_name.value + "\"";
    				oldUploads.push(newUpload);
                    Cookies.set("uploads", JSON.stringify(oldUploads));
                    return true;
    			}
    			function fixStuff()
    			{
					document.getElementById("uploadDropzone").innerHTML += '<input class="submitButton" type="submit" value="OK">'
    			}

    		</script>
    	</div>

    	<script>

    	</script>
	</body>
</html>